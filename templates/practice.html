<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Practice Sandbox - PyQuest</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&family=Fira+Code:wght@400;500&display=swap" rel="stylesheet">
</head>
<body>
    <nav class="navbar">
        <div class="container">
            <div class="nav-brand">
                <span class="logo">üêç</span>
                <span class="brand-text">PyQuest</span>
            </div>
            <div class="nav-links">
                <a href="/" class="nav-link">Dashboard</a>
                <a href="/challenge" class="nav-link">Today's Challenge</a>
                <a href="/browse" class="nav-link">Browse</a>
                <a href="/practice" class="nav-link active">Practice</a>
                <a href="/tools" class="nav-link">Tools</a>
                <a href="/progress" class="nav-link">Progress</a>
                <button class="theme-toggle" onclick="toggleTheme()" aria-label="Toggle theme">
                    <span class="theme-toggle-icon">üåì</span>
                </button>
            </div>
        </div>
    </nav>

    <main class="main-content">
        <div class="container-wide">
            <h1>üéÆ Practice Sandbox</h1>
            <p class="page-subtitle">AI-generated unique challenges based on topics you choose</p>
            <div class="ai-badge">‚ú® Powered by AI - Every challenge is unique!</div>

            <div class="practice-layout">
                <!-- Filters Sidebar -->
                <div class="practice-filters">
                    <h2>üéØ Filter Practice</h2>
                    
                    <div class="filter-section">
                        <h3>Difficulty</h3>
                        <div class="filter-group">
                            <label><input type="radio" name="difficulty" value=""> All</label>
                            <label><input type="radio" name="difficulty" value="beginner"> Beginner</label>
                            <label><input type="radio" name="difficulty" value="intermediate"> Intermediate</label>
                            <label><input type="radio" name="difficulty" value="advanced"> Advanced</label>
                        </div>
                    </div>

                    <div class="filter-section">
                        <h3>Topics to Practice</h3>
                        <div class="filter-group">
                            <label><input type="checkbox" name="topics" value="functions"> Functions</label>
                            <label><input type="checkbox" name="topics" value="variables"> Variables</label>
                            <label><input type="checkbox" name="topics" value="strings"> Strings</label>
                            <label><input type="checkbox" name="topics" value="loops"> Loops</label>
                            <label><input type="checkbox" name="topics" value="conditions"> If/Else</label>
                            <label><input type="checkbox" name="topics" value="lists"> Lists</label>
                            <label><input type="checkbox" name="topics" value="dictionaries"> Dictionaries</label>
                            <label><input type="checkbox" name="topics" value="math"> Math Operations</label>
                        </div>
                    </div>

                    <button class="btn btn-primary" onclick="getRandomChallenge()">
                        üé≤ Get Random Challenge
                    </button>

                    <div class="practice-tips">
                        <h3>üí° Practice Tips</h3>
                        <ul>
                            <li>Select topics you're uncomfortable with</li>
                            <li>Start with beginner difficulty</li>
                            <li>Each challenge is unique!</li>
                            <li>Try solving without hints first</li>
                            <li>Practice makes perfect!</li>
                        </ul>
                    </div>
                    
                    <div class="practice-tips">
                        <h3>üîë Enable AI Generation</h3>
                        <p style="font-size: 0.875rem; color: var(--text-secondary);">
                            To unlock unlimited unique challenges, add your OpenAI API key to the .env file. 
                            <a href="https://platform.openai.com/api-keys" target="_blank" style="color: var(--primary);">Get a key here</a>
                        </p>
                    </div>
                </div>

                <!-- Challenge Display -->
                <div class="practice-content">
                    <div id="practiceChallenge" class="practice-empty">
                        <div class="empty-state-large">
                            <div class="empty-icon">‚ú®</div>
                            <h2>Ready for AI-Generated Practice?</h2>
                            <p>Select your difficulty and topics, then click "Get Random Challenge"</p>
                            <p class="empty-hint">AI will create a unique problem just for you!</p>
                            <p class="empty-hint" style="margin-top: 1rem; font-size: 0.85rem;">
                                üí° Tip: Add OPENAI_API_KEY to your .env file for AI generation
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </main>

    <footer class="footer">
        <div class="container">
            <p>&copy; 2026 PyQuest - Your Path to Python Mastery üêç</p>
        </div>
    </footer>

    <script>
        async function getRandomChallenge() {
            const difficulty = document.querySelector('input[name="difficulty"]:checked')?.value || '';
            const topicsCheckboxes = document.querySelectorAll('input[name="topics"]:checked');
            const topics = Array.from(topicsCheckboxes).map(cb => cb.value);

            // Show loading state
            displayLoading();

            // Build query string
            const params = new URLSearchParams();
            if (difficulty) params.append('difficulty', difficulty);
            topics.forEach(topic => params.append('topics', topic));

            try {
                const response = await fetch(`/api/random-challenge?${params}`);
                const challenge = await response.json();

                if (challenge.error) {
                    displayError(challenge.error, challenge.message, challenge.instructions);
                } else {
                    displayChallenge(challenge);
                }
            } catch (error) {
                displayError('Failed to generate challenge', 'Please try again or check your connection.');
            }
        }

        function displayLoading() {
            const container = document.getElementById('practiceChallenge');
            container.className = 'practice-loading';
            container.innerHTML = `
                <div class="loading-state">
                    <div class="loading-spinner">‚ú®</div>
                    <h2>Generating Your Challenge...</h2>
                    <p>AI is creating a unique problem just for you!</p>
                    <div class="loading-dots">
                        <span>.</span><span>.</span><span>.</span>
                    </div>
                </div>
            `;
        }

        function displayChallenge(challenge) {
            const container = document.getElementById('practiceChallenge');
            container.className = 'practice-challenge-display';
            container.innerHTML = `
                <div class="practice-header">
                    <div>
                        <h2>${challenge.title}</h2>
                        <p class="challenge-topic">${challenge.topic}</p>
                    </div>
                    <div class="practice-meta">
                        <span class="difficulty-badge ${challenge.difficulty}">${challenge.difficulty}</span>
                        <span class="meta-item">‚è±Ô∏è ${challenge.time_estimate}</span>
                        <span class="meta-item">üìÖ Week ${challenge.week}, Day ${challenge.day}</span>
                    </div>
                </div>

                <div class="practice-description markdown-content">
                    ${challenge.description || 'No description available'}
                </div>

                <div class="practice-instructions markdown-content">
                    <h3>Instructions:</h3>
                    ${challenge.instructions || 'No instructions available'}
                </div>

                <div class="practice-actions">
                    <a href="/challenge?week=${challenge.week}&day_num=${challenge.day}" class="btn btn-primary">
                        üìù Open Full Challenge
                    </a>
                    <button class="btn btn-secondary" onclick="getRandomChallenge()">
                        üé≤ Another Random Challenge
                    </button>
                </div>
            `;
        }

        function displayError(title, message, instructions) {
            const container = document.getElementById('practiceChallenge');
            container.className = 'practice-empty';
            
            let instructionsHTML = '';
            if (instructions && Array.isArray(instructions)) {
                instructionsHTML = '<ol class="error-instructions">' +
                    instructions.map(i => `<li>${i}</li>`).join('') +
                    '</ol>';
            }
            
            container.innerHTML = `
                <div class="empty-state-large">
                    <div class="empty-icon">‚ö†Ô∏è</div>
                    <h2>${title || 'Error'}</h2>
                    <p>${message || 'Something went wrong'}</p>
                    ${instructionsHTML}
                    <button class="btn btn-primary" onclick="getRandomChallenge()">Try Again</button>
                </div>
            `;
        }
    </script>

    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
</body>
</html>
